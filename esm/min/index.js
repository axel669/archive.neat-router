import{useState as t,useMemo as e,useEffect as n,Children as r}from"react";function o(){return(o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}const l=t=>{if(void 0===t)return e=>({url:e,params:{},route:t});const e=t.slice(1).split("/");if("/"===t)return(e,{exact:n})=>""!==e.slice(1)&&!0===n?null:{url:e,params:{},route:t};const n=e.map(t=>{const e=t.match(/^((?<path>\w+)|(:(?<name>\w+)(\((?<regex>.+?)\))?)|(\*(?<rest>\w+$)))$/);if(null===e)return null;const{groups:n}=e;if(void 0!==n.path)return([t,...e])=>t===n.path?e:null;if(void 0!==n.rest)return(t,e)=>(e[n.rest]=t.join("/"),[]);if(void 0!==n.name){const t=void 0===n.regex?/^.+$/:new RegExp(`^${t}$`);return([e,...r],o)=>void 0!==e&&!0===t.test(e)?(o[n.name]=e,r):null}return null});return n.filter(t=>null===t).length>0?(console.warn(`Invalid route: ${t}`),()=>null):(e,{exact:r}={})=>{const o={};let l=e.slice(1).split("/");for(const t of n)if(null===(l=t(l,o)))return null;return l.length>0&&!0===r?null:{url:e,params:o,route:t}}},u=t=>n(t,[]),s=t=>e(()=>l(t),[t]);function a(e){return{Route:function(n){const[r,l]=t(e.url),{path:a,exact:c,component:i,...h}=n,p=s(a);u(()=>e.subscribe(l));const f=p(r,{exact:c});return null===f?null:React.createElement(i,o({},h,{neat:f}))},Switch:function(n){const[s,a]=t(e.url),{children:c,...i}=n,h=r.toArray(c);u(()=>e.subscribe(a));for(const{props:t}of h){const{path:e,exact:n,component:r,...u}=t,a=l(e)(s,{exact:n});if(null!==a)return React.createElement(r,o({},i,u,{neat:a}))}return null}}}const c=()=>{const t=new Map;return{subscribe:e=>{const n=`${Date.now()}:${Math.random()}`;return t.set(n,e),()=>t.delete(n)},publish:e=>{for(const n of t.values())n(e)}}},i=()=>{const t=c(),e={get hash(){return location.hash.toString().replace(/^#/,"")},get subscribe(){return t.subscribe},get url(){return e.hash}};e.initialState=e.hash;let n=e.hash;return setInterval(()=>{const r=e.hash;r!==n&&(n=r,t.publish(r))},50),e};export{i as HashPublisher,c as Publisher,a as Router};
